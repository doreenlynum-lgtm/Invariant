# Invariant é¡¹ç›®å®¢è§‚åˆ†æä¸æ”¹è¿›è®¡åˆ’

## ğŸ“Š å½“å‰çŠ¶æ€è¯„ä¼°

### âœ… é¡¹ç›®ä¼˜åŠ¿ï¼ˆåšå¾—å¥½çš„åœ°æ–¹ï¼‰

| ç»´åº¦ | è¯„ä»· | è¯´æ˜ |
|-----|-----|-----|
| **Moveåˆçº¦è®¾è®¡** | â­â­â­â­ | `vault.move` å’Œ `risk_manager.move` ç»“æ„æ¸…æ™°ï¼Œé”™è¯¯ç ã€äº‹ä»¶ã€è§†å›¾å‡½æ•°å®Œæ•´ |
| **PTBåŸå­åŒ–** | â­â­â­â­â­ | `ptb_builder.ts` æ­£ç¡®å®ç°äº†Scallopå­˜æ¬¾+å€Ÿè´·+DeepBookå¯¹å†²çš„åŸå­åŒ–æ“ä½œ |
| **é£é™©å‚æ•°åŒ–** | â­â­â­â­ | LTVã€æ»‘ç‚¹ã€ä»·æ ¼æœ‰æ•ˆæœŸã€å¤´å¯¸å¤§å°éƒ½å¯é…ç½®ï¼Œç¬¦åˆç”Ÿäº§çº§è¦æ±‚ |
| **é‡‘èé€»è¾‘** | â­â­â­â­ | Deltaä¸­æ€§å¯¹å†²è®¡ç®—æ­£ç¡®ï¼ˆhedgeSize = borrowAmount / priceï¼‰ |
| **å‰ç«¯UI** | â­â­â­ | Glassmorphismé£æ ¼ç¾è§‚ï¼ŒLTVè¿›åº¦æ¡ã€å¯¹å†²é¢„è§ˆç­‰UXè€ƒé‡ä¸é”™ |
| **æµ‹è¯•è¦†ç›–** | â­â­â­ | åŸºç¡€LTV/æ»‘ç‚¹æµ‹è¯•å­˜åœ¨ï¼Œä½†ç¼ºå°‘é›†æˆæµ‹è¯• |

### âŒ å…³é”®ç¼ºé™·ï¼ˆéœ€è¦æ”¹è¿›ï¼‰

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“ |
|:-----:|------|-----|
| **P0** | READMEåªæœ‰2è¡Œ | è¯„å§”æ— æ³•å¿«é€Ÿç†è§£é¡¹ç›®ï¼Œç›´æ¥å½±å“è¯„åˆ† |
| **P0** | æ— æ¶æ„å›¾/æŠ€æœ¯æ–‡æ¡£ | ä¸Equinoxå·®è·æ˜æ˜¾ï¼ˆEquinoxæœ‰è¯¦ç»†æ¶æ„è¯´æ˜ï¼‰ |
| **P1** | DeepBook AccountCapç¡¬ç¼–ç ä¸º`0x...` | å®é™…äº¤æ˜“ä¼šå¤±è´¥ |
| **P1** | Vault IDåœ¨å‰ç«¯ç¡¬ç¼–ç ä¸º`VAULT_ID` | æ— æ³•æ‰§è¡ŒçœŸå®å­˜æ¬¾ |
| **P1** | æ— çœŸå®é¢„è¨€æœºé›†æˆ | Mockä»·æ ¼$3.50ä¸å¤Ÿè¯´æœåŠ› |
| **P2** | ç¼ºå°‘zkLoginé›†æˆ | å…¶ä»–é¡¹ç›®ï¼ˆEquinox, SuiGateï¼‰éƒ½æœ‰ |
| **P2** | é¡¹ç›®åç§°ä¸ä¸€è‡´ | GitHubå«Invariantï¼Œä»£ç å†…å«atomic_quant |

---

## ğŸ› ï¸ æ”¹è¿›è®¡åˆ’

### Phase 1: ç´§æ€¥æ–‡æ¡£æ”¹è¿› (å½±å“è¯„åˆ†ï¼Œ2å°æ—¶)

#### 1.1 é‡å†™README.md

```markdown
# Invariant ğŸ›¡ï¸

High-performance quantitative trading vaults on Sui with **on-chain risk management** and **asset safety**.

## ğŸ¯ Problem
Traditional DeFi borrowing exposes users to **price volatility risk**. When SUI price drops, positions get liquidated.

## ğŸ’¡ Solution
Invariant implements **Delta-Neutral Hedging** in a **single atomic transaction**:
1. **Deposit** SUI as collateral (via Scallop)
2. **Borrow** USDC against collateral
3. **Open short** position (via DeepBook)

All three operations execute atomically - **all succeed or all fail**.

## ğŸ”§ Architecture
[æ·»åŠ æ¶æ„å›¾]

## âš¡ Quick Start
[æ·»åŠ è¿è¡Œè¯´æ˜]

## ğŸ“‚ Project Structure
[æ·»åŠ ç›®å½•ç»“æ„]
```

#### 1.2 æ·»åŠ æ¶æ„å›¾

```
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚     Frontend (Next.js)      â”‚
                                 â”‚  â€¢ Wallet Connect (dApp-kit)â”‚
                                 â”‚  â€¢ LTV Dashboard            â”‚
                                 â”‚  â€¢ Atomic Hedge UI          â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SDK (@saq/sdk)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ PTBBuilder  â”‚  â”‚ DeepBook    â”‚  â”‚ Oracle      â”‚  â”‚ Config      â”‚        â”‚
â”‚  â”‚ (Atomic TX) â”‚  â”‚ Service     â”‚  â”‚ Service     â”‚  â”‚             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Sui Blockchain                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ vault.move  â”‚  â”‚risk_manager â”‚  â”‚  Scallop    â”‚  â”‚  DeepBook   â”‚        â”‚
â”‚  â”‚             â”‚  â”‚   .move     â”‚  â”‚  (Lending)  â”‚  â”‚   (CLOB)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Phase 2: ä»£ç å…³é”®ä¿®å¤ (4å°æ—¶)

#### 2.1 ä¿®å¤DeepBook AccountCapé—®é¢˜

**å½“å‰é—®é¢˜** (`sdk/src/deepbook_service.ts:217-220`):
```typescript
private getAccountCapId(): string {
    // å®é™…ä½¿ç”¨æ—¶éœ€è¦ä»é“¾ä¸ŠæŸ¥è¯¢æˆ–åˆ›å»º
    return "0x...";  // âŒ ç¡¬ç¼–ç å ä½ç¬¦
}
```

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// æ–°å¢æ–¹æ³•ï¼šåˆ›å»ºæˆ–è·å–AccountCap
async getOrCreateAccountCap(tx: Transaction): Promise<void> {
    // æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²æœ‰AccountCap
    const accountCaps = await this.client.getOwnedObjects({
        owner: this.senderAddress,
        filter: { StructType: `${this.config.packageId}::clob_v2::AccountCap` }
    });
    
    if (accountCaps.data.length === 0) {
        // åˆ›å»ºæ–°çš„AccountCap
        this.addCreateAccount(tx);
    }
}
```

#### 2.2 ä¿®å¤å‰ç«¯Vault IDé—®é¢˜

**å½“å‰é—®é¢˜** (`frontend/src/app/page.tsx:94`):
```typescript
tx.object("VAULT_ID"), // âŒ ç¡¬ç¼–ç å ä½ç¬¦
```

**ä¿®å¤æ–¹æ¡ˆ**: æ·»åŠ VaultæŸ¥è¯¢å’Œé€‰æ‹©é€»è¾‘

```typescript
// æŸ¥è¯¢ç”¨æˆ·çš„Vault
const [userVaults, setUserVaults] = useState<string[]>([]);

useEffect(() => {
    if (account) {
        fetchUserVaults(account.address);
    }
}, [account]);

async function fetchUserVaults(address: string) {
    const objects = await client.getOwnedObjects({
        owner: address,
        filter: { StructType: `${PACKAGE_ID}::vault::Vault` }
    });
    setUserVaults(objects.data.map(o => o.data?.objectId).filter(Boolean));
}
```

#### 2.3 é›†æˆçœŸå®é¢„è¨€æœº

**å½“å‰é—®é¢˜**: Mockä»·æ ¼
```typescript
const MOCK_SUI_PRICE = 3.50;  // âŒ
```

**ä¿®å¤æ–¹æ¡ˆ**: ä½¿ç”¨Pythé¢„è¨€æœº

```typescript
import { SuiPriceServiceConnection } from "@pythnetwork/pyth-sui-js";

const priceService = new SuiPriceServiceConnection("https://hermes.pyth.network");
const suiPrice = await priceService.getLatestPriceFeeds([SUI_USD_FEED_ID]);
```

---

### Phase 3: åŠŸèƒ½å¢å¼º (å¯é€‰ï¼Œæå‡æ’å)

| åŠŸèƒ½ | éš¾åº¦ | å½±å“ | è¯´æ˜ |
|-----|-----|-----|-----|
| zkLoginé›†æˆ | ä¸­ | é«˜ | æ·»åŠ æ— åŠ©è®°è¯ç™»å½•ï¼Œå¯¹æ ‡Equinox/SuiGate |
| å®æ—¶LTVç›‘æ§ | ä½ | ä¸­ | ä½¿ç”¨WebSocketè®¢é˜…VaultçŠ¶æ€å˜åŒ– |
| æ¸…ç®—ä¿æŠ¤ | é«˜ | é«˜ | è‡ªåŠ¨å‡ä»“æœºåˆ¶ |
| å¤šèµ„äº§æ”¯æŒ | ä¸­ | ä¸­ | æ”¯æŒwETHã€wBTCä½œä¸ºæŠµæŠ¼å“ |

---

## ğŸ“ å…·ä½“æ”¹è¿›æ­¥éª¤

### æ­¥éª¤1: é‡å†™READMEï¼ˆ30åˆ†é’Ÿï¼‰

1. æ·»åŠ é¡¹ç›®Logo/Banner
2. å†™æ¸…æ¥šProblem â†’ Solution â†’ Architecture
3. æ·»åŠ æŠ€æœ¯æ ˆbadges
4. æ·»åŠ Quick StartæŒ‡å—
5. æ·»åŠ æˆªå›¾/GIFæ¼”ç¤º

### æ­¥éª¤2: ä¿®å¤å…³é”®ä»£ç ï¼ˆ2å°æ—¶ï¼‰

1. **DeepBook AccountCap**
   - æ–‡ä»¶: `sdk/src/deepbook_service.ts`
   - æ·»åŠ `getOrCreateAccountCap`æ–¹æ³•
   - åœ¨`addLimitSellOrder`å‰è°ƒç”¨

2. **Vault IDåŠ¨æ€æŸ¥è¯¢**
   - æ–‡ä»¶: `frontend/src/app/page.tsx`
   - æ·»åŠ `fetchUserVaults`å‡½æ•°
   - æ·»åŠ Vaulté€‰æ‹©ä¸‹æ‹‰æ¡†

3. **é¢„è¨€æœºé›†æˆ**
   - æ–‡ä»¶: `sdk/src/oracle_service.ts`
   - å·²æœ‰Pythé›†æˆæ¡†æ¶ï¼Œç¡®ä¿åœ¨å‰ç«¯è°ƒç”¨

### æ­¥éª¤3: æ·»åŠ æ¼”ç¤ºè§†é¢‘ï¼ˆ1å°æ—¶ï¼‰

- å½•åˆ¶å®Œæ•´æµç¨‹ï¼šè¿æ¥é’±åŒ… â†’ åˆ›å»ºVault â†’ ä¸€é”®å¯¹å†²
- ä¸Šä¼ åˆ°YouTube/Loomï¼Œé“¾æ¥æ”¾å…¥README

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | å½“å‰ | æ”¹è¿›å |
|-----|-----|-------|
| READMEå®Œæ•´åº¦ | 10% | 90% |
| è¯„å§”é¦–å°è±¡ | â­â­ | â­â­â­â­ |
| å¯è¿è¡Œæ¼”ç¤º | âŒ | âœ… |
| é¢„è®¡æ’å | 7/12 | 4-5/12 |

---

## âš ï¸ å®¢è§‚å»ºè®®

### ä¸Equinoxï¼ˆç¬¬1åï¼‰çš„å·®è·

| ç»´åº¦ | Equinox | Invariant |
|-----|---------|-----------|
| ZKéšç§ | âœ… ZK-Privacy Orders | âŒ |
| AIé›†æˆ | âœ… Nautilus AIå…¬å¹³åŒ¹é… | âŒ |
| æ–‡æ¡£è´¨é‡ | âœ… å®Œæ•´Problem/Solution | âŒ 2è¡ŒREADME |
| Suiç‰¹æ€§ | âœ… zkLogin + DeepBook + Walrus | âš ï¸ DeepBook (æœªå®Œå–„) |

**æ ¸å¿ƒå·®è·**: Equinoxè§£å†³äº†6ä¸ªæ˜ç¡®çš„DeFiç—›ç‚¹ï¼ŒInvariantåªè§£å†³äº†1ä¸ªï¼ˆä»·æ ¼æ³¢åŠ¨é£é™©ï¼‰ã€‚

### å¯è¡Œçš„å·®å¼‚åŒ–æ–¹å‘

1. **ä¸“æ³¨é‡åŒ–äº¤æ˜“**: Equinoxæ˜¯å€Ÿè´·åè®®ï¼Œä½ å¯ä»¥åš**é‡åŒ–ç­–ç•¥é‡‘åº“**
2. **æ·»åŠ Keeperæœºåˆ¶**: è‡ªåŠ¨è°ƒä»“/å†å¹³è¡¡
3. **ç­–ç•¥å¸‚åœº**: è®©ç”¨æˆ·åˆ›å»ºå’Œåˆ†äº«å¯¹å†²ç­–ç•¥

---

## éªŒè¯è®¡åˆ’

### è‡ªåŠ¨åŒ–æµ‹è¯•

```bash
# Moveåˆçº¦æµ‹è¯•
cd move_contracts
sui move test

# SDKå•å…ƒæµ‹è¯•  
cd sdk
npm test
```

### æ‰‹åŠ¨æµ‹è¯•

1. **å‰ç«¯å¯åŠ¨**: `cd frontend && npm run dev`
2. **è¿æ¥é’±åŒ…**: ä½¿ç”¨Sui Wallet
3. **åˆ›å»ºVault**: ç‚¹å‡»"åˆ›å»ºæ–°é‡‘åº“"
4. **éªŒè¯äº¤æ˜“**: åœ¨Sui ExploreræŸ¥çœ‹

### é›†æˆæµ‹è¯•ï¼ˆTestnetï¼‰

1. è·å–æµ‹è¯•ä»£å¸: `sui client faucet`
2. æ‰§è¡Œå®Œæ•´å¯¹å†²æµç¨‹
3. éªŒè¯VaultçŠ¶æ€å˜åŒ–
